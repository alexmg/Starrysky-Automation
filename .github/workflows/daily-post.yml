name: Daily Bluesky Post

on:
  # schedule:
  #   - cron: '0 15 * * *'
  workflow_dispatch:
    inputs:
      dryRun:
        required: false
        default: false
        description: "Execute a dry-run that does not post to Bluesky"
        type: boolean

jobs:
  post:
    name: Post to Bluesky
    permissions:
      contents: write
      packages: read
    env:
      DOTNET_NOLOGO: true
      DOTNET_CLI_TELEMETRY_OPTOUT: true
    runs-on: ubuntu-latest
    steps:
      - name: ðŸ›’ Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          fetch-depth: 0
          filter: tree:0

      - name: ðŸ­ Setup .NET SDK
        uses: actions/setup-dotnet@87b7050bc53ea08284295505d98d2aa94301e852 # v4.2.0
        with:
          dotnet-version: '9.0.x'

      - name: ðŸ” Display .NET information
        run: dotnet --info

      - name: ðŸ“¦ Add GitHub Packages source
        run: >
         dotnet nuget add source \
           --name github \
           --username alexmg \
           --password ${{ secrets.GITHUB_TOKEN }} \
           --store-password-in-clear-text \
           https://nuget.pkg.github.com/alexmg/index.json

      - name: ðŸ”¨ Install global tool
        run: dotnet tool install --global Starrysky --ignore-failed-sources

      - name: ðŸš€ Execute global tool
        run: >
          starrysky \
            --token ${{ secrets.GitHubToken }} \
            --handle ${{ secrets.BlueskyHandle }} \
            --password ${{ secrets.BlueskyPassword }} \
            --dry-run ${{ inputs.dryRun }}
